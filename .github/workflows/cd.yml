on:
  push:
    tags:
      - release/stage/major
      - release/stage/minor
      - release/stage/patch
      - release/stage/build
      - release/prod/major
      - release/prod/minor
      - release/prod/patch
      - release/prod/build
    
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
     - name: ⬇️ Checkout repo+tags
       uses: actions/checkout@v3
       with:
         fetch-depth: 0
     - name: 🏷 Parse action tag
       id: parse-action-tag
       run: .github/workflows/scripts/parse-action-tag.sh ${{ github.event.ref }}
     - name: 🔎 Get version
       id: get-version
       run: .github/workflows/scripts/get-version.sh
     - name: ⏩ Bump version
       id: bump-version
       run: .github/workflows/scripts/bump-version.sh ${{ steps.parse-action-tag.outputs.ACTION }} ${{ steps.get-version.outputs.VERSION }}
     - name: Update pubsepc version
       run: .github/workflows/scripts/update-pubspec.sh ${{ steps.bump-version.outputs.VERSION }}
     - name: check pubspec
       run: cat pubspec.yaml
     - name: report
       run: echo "${{ steps.get-version.outputs.VERSION }} -> ${{ steps.bump-version.outputs.VERSION }}"
       #run: echo 'by ${{ github.event.pusher.name }} (${{ github.event.pusher.email }})'


# if version not null!
#  sed -i ''  "s/^version: .*$/version: 1.0.0+3/" ../../../pubspec.yaml
# remove action tag!!!!!
# tag v{new version}

# https://github.com/stefanzweifel/git-auto-commit-action/blob/master/entrypoint.sh
# git push
