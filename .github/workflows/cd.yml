on:
  push:
    tags:
      - release/stage/major
      - release/stage/minor
      - release/stage/patch
      - release/stage/build
      - release/prod/major
      - release/prod/minor
      - release/prod/patch
      - release/prod/build

permissions: write-all
    
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
     - name: â¬‡ï¸ Checkout repo+tags
       uses: actions/checkout@v3
       with:
         fetch-depth: 0
     - name: ğŸ· Parse action tag
       id: parse-action-tag
       run: .github/workflows/scripts/parse-action-tag.sh ${{ github.event.base_ref }} ${{ github.event.ref }}
     - name: ğŸ” Get version
       id: get-version
       run: .github/workflows/scripts/get-version.sh
     - name: â© Bump version
       id: bump-version
       run: .github/workflows/scripts/bump-version.sh ${{ steps.parse-action-tag.outputs.ACTION }} ${{ steps.get-version.outputs.VERSION }}
     - name: â¬†ï¸ Update pubsepc version
       run: .github/workflows/scripts/update-pubspec.sh ${{ steps.parse-action-tag.outputs.BRANCH }} ${{ steps.bump-version.outputs.VERSION }} ${{ github.event.pusher.name }} ${{ github.event.pusher.email }}
     - name: ğŸ” Rollout tags
       run: .github/workflows/scripts/update-tags.sh ${{ steps.parse-action-tag.outputs.TAG }} ${{ steps.bump-version.outputs.VERSION }} ${{ github.event.pusher.name }} ${{ github.event.pusher.email }}